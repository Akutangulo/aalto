<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicación para marcar los tiempos en los remontados - Temporizador de cuenta atrás</title>
    
    <style>  
/* Estilos base (mobile first) */
body {
    font-family: Arial, sans-serif;
    background-color: #f9f3f4;
    color: #4a0e1c;
    margin: 0;
    padding: 5px;
    font-size: 14px;
    box-sizing: border-box;
}

*, *:before, *:after {
    box-sizing: inherit;
}

.container {
    display: flex;
    flex-wrap: nowrap;
    justify-content: space-between;
    gap: 5px;
    max-width: 100%;
}

.column {
    flex: 0 0 calc(50% - 2.5px);
    background-color: #ffffff;
    border-radius: 8px;
    padding: 5px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.deposito {
    background-color: #f5e6e8;
    border: 1px solid #8c1c2c;
    border-radius: 8px;
    padding: 6px;
    margin-bottom: 8px;
}

label {
    display: block;
    margin-bottom: 2px;
    font-weight: bold;
    color: #6b0f1a;
    font-size: 12px;
}

.minutes-input {
    width: 100%;
    padding: 6px;
    margin-bottom: 6px;
    border: 1px solid #d4b6b9;
    border-radius: 4px;
    font-size: 14px;
    box-sizing: border-box;
    -moz-appearance: textfield;
}

.minutes-input::-webkit-outer-spin-button,
.minutes-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.start-button {
    background-color: #8c1c2c;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s;
    width: 100%;
    margin-bottom: 8px;
    text-transform: uppercase;
    font-weight: bold;
}

.start-button:hover, .start-button:active {
    background-color: #6b0f1a;
}

.timer, .end-time {
    font-size: 14px;
    font-weight: bold;
    margin: 6px 0;
    text-align: center;
    color: #4a0e1c;
}

input[type="checkbox"] {
    margin-right: 3px;
}

.toggle-button {
    background-color: #d4b6b9;
    color: #4a0e1c;
    border: none;
    padding: 6px 8px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.toggle-button:hover, .toggle-button:active {
    background-color: #c39ea3;
}

.active {
    background-color: #ffdbd6;
}

.finished {
    background-color: #d4edda;
}

#new-session-button {
    background-color: #6b0f1a;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s;
    width: 100%;
    margin-bottom: 12px;
    text-transform: uppercase;
    font-weight: bold;
}

#new-session-button:hover, #new-session-button:active {
    background-color: #4a0e1c;
}

/* Media queries para pantallas más grandes */
@media (min-width: 375px) {
    body {
        padding: 8px;
    }

    .deposito {
        padding: 8px;
        margin-bottom: 10px;
    }

    .start-button {
        padding: 10px;
        font-size: 16px;
    }
}

@media (min-width: 480px) {
    body {
        padding: 10px;
        font-size: 16px;
    }

    .container {
        gap: 10px;
    }

    .column {
        padding: 10px;
    }

    .deposito {
        padding: 12px;
        margin-bottom: 15px;
    }

    label {
        font-size: 14px;
    }

    .minutes-input {
        padding: 8px;
        font-size: 16px;
    }

    .start-button {
        padding: 12px;
        font-size: 18px;
    }

    .timer, .end-time {
        font-size: 16px;
    }

    .toggle-button {
        padding: 8px 10px;
        font-size: 14px;
    }
}

@media (min-width: 768px) {
    body {
        padding: 15px;
    }

    .container {
        gap: 15px;
    }

    .column {
        padding: 15px;
    }

    .deposito {
        padding: 15px;
        margin-bottom: 20px;
    }

    .start-button {
        padding: 15px;
        font-size: 20px;
    }

    .timer, .end-time {
        font-size: 18px;
    }
}
    </style>
    
</head>
<body>
    <!-- Botón para iniciar nueva sesión -->
    <button id="new-session-button">Iniciar Nueva Sesión de Remontados</button>
   <div class="container">
        <div class="column">
    <div class="deposito">
        <label for="minutesInput1">Deposito 1 - V1:</label>
        <input type="number" id="minutesInput1" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer1">Iniciar remontado</button>
        <div id="timer1" class="timer"></div>
        <div id="endTime1" class="end-time"></div> <!-- Elemento para mostrar la hora de finalización -->
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer1" data-status="off">Pausar/Reanudar</button> <!-- Botón de encender/apagar -->
    </div>

    <div class="deposito">
        <label for="minutesInput2">Deposito 2 - H4:</label>
        <input type="number" id="minutesInput2" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer2">Iniciar remontado</button>
        <div id="timer2" class="timer"></div>
        <div id="endTime2" class="end-time"></div>
        <input type="checkbox" checked style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer2" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput3">Deposito 3 - H5:</label>
        <input type="number" id="minutesInput3" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer3">Iniciar remontado</button>
        <div id="timer3" class="timer"></div>
        <div id="endTime3" class="end-time"></div>
        <input type="checkbox" checked style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer3" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput4">Deposito 4 - H6:</label>
        <input type="number" id="minutesInput4" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer4">Iniciar remontado</button>
        <div id="timer4" class="timer"></div>
        <div id="endTime4" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer4" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput5">Deposito 5 - BD1:</label>
        <input type="number" id="minutesInput5" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer5">Iniciar remontado</button>
        <div id="timer5" class="timer"></div>
        <div id="endTime5" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer5" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput6">Deposito 6: - P3</label>
        <input type="number" id="minutesInput6" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer6">Iniciar remontado</button>
        <div id="timer6" class="timer"></div>
        <div id="endTime6" class="end-time"></div>
        <input type="checkbox" checked style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer6" data-status="off">Pausar/Finalizar</button>
    </div>
    
     <div class="deposito">
        <label for="minutesInput7">Deposito 7:</label>
        <input type="number" id="minutesInput7" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer7">Iniciar remontado</button>
        <div id="timer7" class="timer"></div>
         <div id="endTime7" class="end-time"></div>
         <input type="checkbox" checked style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer7" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput8">Deposito 8:</label>
        <input type="number" id="minutesInput8" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer8">Iniciar remontado</button>
        <div id="timer8" class="timer"></div>
         <div id="endTime8" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer8" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput9">Deposito 9:</label>
        <input type="number" id="minutesInput9" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer9">Iniciar remontado</button>
        <div id="timer9" class="timer"></div>
         <div id="endTime9" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer9" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput10">Deposito 10:</label>
        <input type="number" id="minutesInput10" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer10">Iniciar remontado</button>
        <div id="timer10" class="timer"></div>
         <div id="endTime10" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer10" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput11">Deposito 11 - F1:</label>
        <input type="number" id="minutesInput11" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer11">Iniciar remontado</button>
        <div id="timer11" class="timer"></div>
        <div id="endTime11" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer11" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput12">Deposito 12 - H3:</label>
        <input type="number" id="minutesInput12" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer12">Iniciar remontado</button>
        <div id="timer12" class="timer"></div>
        <div id="endTime12" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer12" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput13">Deposito 13 - H2:</label>
        <input type="number" id="minutesInput13" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer13">Iniciar remontado</button>
        <div id="timer13" class="timer"></div>
        <div id="endTime13" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer13" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput14">Deposito 14 - H1:</label>
        <input type="number" id="minutesInput14" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer14">Iniciar remontado</button>
        <div id="timer14" class="timer"></div>
        <div id="endTime14" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer14" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput15">Deposito 15 - M1:</label>
        <input type="number" id="minutesInput15" class="minutes-input" min="1" step="1" value="40">
        <button class="start-button" data-target="timer15">Iniciar remontado</button>
        <div id="timer15" class="timer"></div>
        <div id="endTime15" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer15" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput16">Deposito 16 - P2:</label>
        <input type="number" id="minutesInput16" class="minutes-input" min="1" step="1" value="40">
        <button class="start-button" data-target="timer16">Iniciar remontado</button>
        <div id="timer16" class="timer"></div>
        <div id="endTime16" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer16" data-status="off">Pausar/Finalizar</button>
    </div>

  

</div><!-- Fin div column -->
        <div class="clear"></div> <!-- Elemento clear para evitar que los elementos floten hacia abajo -->
<div class="column">
    
     <div class="deposito">
        <label for="minutesInput17">Deposito 17 - A1:</label>
        <input type="number" id="minutesInput17" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer17">Iniciar remontado</button>
        <div id="timer17" class="timer"></div>
         <div id="endTime17" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer17" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput18">Deposito 18 - A2:</label>
        <input type="number" id="minutesInput18" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer18">Iniciar remontado</button>
        <div id="timer18" class="timer"></div>
         <div id="endTime18" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer18" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput19">Deposito 19 - A3:</label>
        <input type="number" id="minutesInput19" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer19">Iniciar remontado</button>
        <div id="timer19" class="timer"></div>
         <div id="endTime19" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer19" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput20">Deposito 20 - H7:</label>
        <input type="number" id="minutesInput20" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer20">Iniciar remontado</button>
        <div id="timer20" class="timer"></div>
         <div id="endTime20" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer20" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput21">Deposito 21 - V2:</label>
        <input type="number" id="minutesInput21" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer21">Iniciar remontado</button>
        <div id="timer21" class="timer"></div>
        <div id="endTime21" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer21" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput22">Deposito 22:</label>
        <input type="number" id="minutesInput22" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer22">Iniciar remontado</button>
        <div id="timer22" class="timer"></div>
        <div id="endTime22" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer22" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput23">Deposito 23:</label>
        <input type="number" id="minutesInput23" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer23">Iniciar remontado</button>
        <div id="timer23" class="timer"></div>
        <div id="endTime23" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer23" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput24">Deposito 24:</label>
        <input type="number" id="minutesInput24" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer24">Iniciar remontado</button>
        <div id="timer24" class="timer"></div>
        <div id="endTime24" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer24" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput25">Deposito 25 - P1:</label>
        <input type="number" id="minutesInput25" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer25">Iniciar remontado</button>
        <div id="timer25" class="timer"></div>
        <div id="endTime25" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer25" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput26">Deposito 26 - E:</label>
        <input type="number" id="minutesInput26" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer26">Iniciar remontado</button>
        <div id="timer26" class="timer"></div>
        <div id="endTime26" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer26" data-status="off">Pausar/Finalizar</button>
    </div>
    
     <div class="deposito">
        <label for="minutesInput27">Deposito 27 - VB2:</label>
        <input type="number" id="minutesInput27" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer27">Iniciar remontado</button>
        <div id="timer27" class="timer"></div>
         <div id="endTime27" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer27" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput28">Deposito 28 - N2:</label>
        <input type="number" id="minutesInput28" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer28">Iniciar remontado</button>
        <div id="timer28" class="timer"></div>
         <div id="endTime28" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer28" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput29">Deposito 29 - N1:</label>
        <input type="number" id="minutesInput29" class="minutes-input" min="1" step="1" value="30">
        <button class="start-button" data-target="timer29">Iniciar remontado</button>
        <div id="timer29" class="timer"></div>
         <div id="endTime29" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer29" data-status="off">Pausar/Finalizarr</button>
    </div>

     <div class="deposito">
        <label for="minutesInput30">Deposito 30 - VB1:</label>
        <input type="number" id="minutesInput30" class="minutes-input" min="1" step="1" value="40">
        <button class="start-button" data-target="timer30">Iniciar remontado</button>
        <div id="timer30" class="timer"></div>
         <div id="endTime30" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer30" data-status="off">Pausar/Finalizar</button>
    </div>

    <div class="deposito">
        <label for="minutesInput31">Deposito 31 - B1:</label>
        <input type="number" id="minutesInput31" class="minutes-input" min="1" step="1" value="40">
        <button class="start-button" data-target="timer31">Iniciar remontado</button>
        <div id="timer31" class="timer"></div>
        <div id="endTime31" class="end-time"></div>
        <input type="checkbox" style="accent-color: red">Automatico
        <button class="toggle-button" data-target="timer31" data-status="off">Pausar/Finalizar</button>
    </div>

     <div class="deposito">
        <label for="minutesInput32">Deposito 32:</label>
        <input type="number" id="minutesInput32" class="minutes-input" min="1" step="1" value="40">
        <button class="start-button" data-target="timer32">Iniciar remontado</button>
        <div id="timer32" class="timer"></div>
        <div id="endTime32" class="end-time"></div>
         <input type="checkbox" style="accent-color: red">Automatico
         <button class="toggle-button" data-target="timer32" data-status="off">Pausar/Finalizar</button>
    </div>

    </div><!-- Fin div column -->
    </div><!-- Fin div container -->

    <script>
        const timers = {};
        const startButtons = document.querySelectorAll(".start-button");
        const toggleButtons = document.querySelectorAll(".toggle-button");
        const minutesInputs = document.querySelectorAll(".minutes-input");
        const newSessionButton = document.getElementById("new-session-button");
    
        // Función para formatear minutos y segundos con dos dígitos
        const formatTime = (time) => (time < 10 ? `0${time}` : time);
    
        // Guardar el estado de los remontados en el localStorage
        const saveStateToLocalStorage = () => {
            localStorage.setItem('timers', JSON.stringify(timers));
        };
    
        // Cargar el estado desde el localStorage
        const loadStateFromLocalStorage = () => {
            const storedTimers = localStorage.getItem('timers');
            if (storedTimers) {
                const parsedTimers = JSON.parse(storedTimers);
                Object.keys(parsedTimers).forEach(timerId => {
                    timers[timerId] = parsedTimers[timerId];
                    const timerDisplay = document.getElementById(timerId);
                    const endTimeDisplay = document.getElementById(`endTime${timerId.replace("timer", "")}`);
                    
                    const now = Date.now();
                    let remainingTime = (timers[timerId].endTime - now) / 1000;
    
                    if (remainingTime <= 0) {
                        timerDisplay.innerHTML = "¡Remontado terminado!";
                        timerDisplay.classList.add("finished");
                    } else {
                        timers[timerId].timeRemaining = remainingTime;
                        const minutos = Math.floor(remainingTime / 60);
                        const segundos = Math.floor(remainingTime % 60);
    
                        timerDisplay.innerHTML = `${formatTime(minutos)}:${formatTime(segundos)}`;
                        endTimeDisplay.innerHTML = `Finaliza a las ${new Date(timers[timerId].endTime).toLocaleTimeString()}`;
                        timerDisplay.classList.add("active");
    
                        // Reiniciar el temporizador
                        timers[timerId].intervalId = setInterval(() => updateTimer(timerId, timerDisplay, endTimeDisplay), 1000);
                    }
                });
            }
        };
    
// Función para actualizar el temporizador
const updateTimer = (timerId, timerDisplay, endTimeDisplay) => {
    const now = Date.now();
    let remainingTime = (timers[timerId].endTime - now) / 1000;

    if (remainingTime <= 0) {
        clearInterval(timers[timerId].intervalId);
        timerDisplay.innerHTML = "¡Remontado terminado!";
        timerDisplay.classList.add("finished");
        
        // Intentar notificar al usuario de múltiples maneras
        notifyUser(timerId);
    } else {
        const minutos = Math.floor(remainingTime / 60);
        const segundos = Math.floor(remainingTime % 60);
        timerDisplay.innerHTML = `${formatTime(minutos)}:${formatTime(segundos)}`;
        
        // Mostrar la hora de finalización sin segundos
        const options = { hour: '2-digit', minute: '2-digit' };
        endTimeDisplay.innerHTML = `Finaliza a las ${new Date(timers[timerId].endTime).toLocaleTimeString([], options)}`;
        
        timerDisplay.classList.add("active");
    }
};

// Nueva función para notificar al usuario
const notifyUser = (timerId) => {
    // Intentar vibrar (si el dispositivo lo soporta)
    if ('vibrate' in navigator) {
        navigator.vibrate([200, 100, 200]);
    }

    // Intentar reproducir el sonido varias veces
    const playSound = () => {
        const audio = new Audio('Isabella_Late_Lp.mp3');
        audio.play().catch(err => console.error("Error al reproducir el audio:", err));
    };

    playSound();

    // Mostrar una notificación persistente
    if ('Notification' in window && Notification.permission === 'granted') {
        const notification = new Notification('Remontado Terminado', {
            body: `El remontado del depósito ${timerId.replace("timer", "")} ha terminado.`,
            requireInteraction: true  // Hace que la notificación sea persistente
        });

        // Cerrar la notificación después de 1 minuto
        setTimeout(() => notification.close(), 60000);
    }
};
    
        // Función para iniciar el temporizador
        const startTimer = (button, index) => {
            button.disabled = true;
            const timerId = button.getAttribute("data-target");
            const minutosElegidos = parseInt(minutesInputs[index].value);
            let segundosRestantes = minutosElegidos * 60;
    
            const horaInicio = Date.now(); // Hora actual en milisegundos
            const horaFinalizacion = horaInicio + segundosRestantes * 1000;
    
            timers[timerId] = {
                intervalId: null,
                isPaused: false,
                timeRemaining: segundosRestantes,
                endTime: horaFinalizacion,
                pauseTime: 0,
                pausedAt: null
            };
    
            const timerDisplay = document.getElementById(timerId);
            const endTimeDisplay = document.getElementById(`endTime${index + 1}`);
            const audio = new Audio('Isabella_Late_Lp.mp3');
    
            const updateTimerLocal = () => {
                updateTimer(timerId, timerDisplay, endTimeDisplay);
                saveStateToLocalStorage(); // Guardar estado cada segundo
            };
    
            timers[timerId].intervalId = setInterval(updateTimerLocal, 1000);
            saveStateToLocalStorage(); // Guardar estado al iniciar
        };
    
        startButtons.forEach((button, index) => {
            button.addEventListener("click", () => startTimer(button, index));
        });
    
        // Función para pausar o reanudar el temporizador
        const toggleTimer = (button, index) => {
            const timerId = button.getAttribute("data-target");
            const status = button.getAttribute("data-status");
    
            if (status === "off") {
                // Pausar el temporizador
                clearInterval(timers[timerId].intervalId);
                timers[timerId].isPaused = true;
                timers[timerId].pausedAt = Date.now(); // Hora de pausa en milisegundos
                button.setAttribute("data-status", "on");
                button.textContent = "Reanudar Remontado";
            } else {
                // Reanudar el temporizador
                const now = Date.now();
                const pauseDuration = now - timers[timerId].pausedAt; // Calcular cuánto tiempo estuvo en pausa
                timers[timerId].endTime += pauseDuration; // Ajustar la hora de finalización
    
                button.setAttribute("data-status", "off");
                button.textContent = "Pausar Remontado";
                timers[timerId].isPaused = false;
    
                const timerDisplay = document.getElementById(timerId);
                const endTimeDisplay = document.getElementById(`endTime${index + 1}`);
    
                const updateTimerLocal = () => {
                    updateTimer(timerId, timerDisplay, endTimeDisplay);
                    saveStateToLocalStorage(); // Guardar estado cada segundo
                };
    
                timers[timerId].intervalId = setInterval(updateTimerLocal, 1000);
            }
            saveStateToLocalStorage(); // Guardar estado al pausar/reanudar
        };
    
        toggleButtons.forEach((button, index) => {
            button.addEventListener("click", () => toggleTimer(button, index));
        });
    
        // Reiniciar sesión y borrar localStorage
        const restartSession = () => {
            localStorage.clear(); // Borrar el localStorage antiguo
            location.reload();
        };
    
        newSessionButton.addEventListener("click", restartSession);
    
        // Cargar el estado desde el localStorage al cargar la página
        loadStateFromLocalStorage();

        // Solicitar permiso para notificaciones al cargar la página
document.addEventListener('DOMContentLoaded', () => {
    loadStateFromLocalStorage();
    if ('Notification' in window) {
        Notification.requestPermission();
    }
});
    
    </script>
</body>
</html>
